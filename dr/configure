#!/bin/bash
source "$( dirname "$(readlink -f "$0")" )/_variables"

function showusage {
cat <<EOF

NAME
   ${SERVICENAME} configure - configure simplesecrets for secret upload
   
SYNOPSIS
   S3KEY=abcde S3SECRET=1234 BUCKET=mybucket ${SERVICENAME} configure

DESCRIPTION
   Stores the S3 key, secret and bucket passed via environment variables into a volume container.
   Required for simplesecrets to be able to upload files.

RETURN VALUE
   0   - success
   1   - error
   3   - no change
   
EOF
   exit 1  
}

# This script is run on the host.
# It launches the docker container and runs our hello world command.

if [ -z "${S3KEY}" ]; then echo "Missing S3KEY." ; showusage ; fi
if [ -z "${S3SECRET}" ]; then echo "Missing S3SECRET." ; showusage ; fi
if [ -z "${BUCKET}" ]; then echo "Missing BUCKET." ; showusage ; fi
               
docker run --name=simplesecrets-configure -i  ${DOCKEROPTS[@]} \
       -e "S3KEY=${S3KEY}" -e "S3SECRET=${S3SECRET}" -e "BUCKET=${BUCKET}" \
       ${IMAGENAME} configure "$@"
 
docker rm simplesecrets-configure >/dev/null
